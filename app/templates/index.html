<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Flask Multi-User Chat</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/chat.css') }}">
  </head>
  <body>
    <h3>No messages yet...</h3>
    <div class="message_holder"></div>

    <form action="" method="POST">
      <input type="text" class="username" placeholder="User Name"/>
      <input type="text" class="message" placeholder="Messages"/>
      <input type="submit"/>
    </form>
  
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.3/socket.io.min.js"></script>
    <script type="text/javascript">
      var url = location.protocol + '//' + document.domain + ':' + location.port
      var socket = io.connect(url)

      socket.on('connect', connected)
      socket.on('my response', response)
      
      function connected(){
        socket.emit('my event', {data: 'User Connected'})
      
        var form = $('form').on('submit', submitted)
      }
      
      function submitted(e){
        e.preventDefault()
        
        let user_name = $('input.username').val()
        let user_input = $('input.message').val()
      
        socket.emit('my event', {user_name: user_name, message: user_input})
      
        $('input.message').val('').focus()
      }
      
      function response(msg){
        console.log(msg)
      
        if (typeof msg.user_name !== 'undefined'){
          $('h3').remove()
      
          let text_box = '<div><b style="color: #000">' + msg.user_name + '</b>: ' + msg.message + '</div>'
          $('div.message_holder').append(text_box)
        }
      }</script>
</html>
